# ğŸ”§ Cä»£ç ç´¢å¼•å·¥å…· - å·¥å…·åˆ†æå’Œæ•´åˆè¯´æ˜

## ğŸ“‹ ç›®å‰ä½¿ç”¨çš„å·¥å…·

å½“å‰ç³»ç»Ÿé›†æˆäº†**5ä¸ªæ ¸å¿ƒåˆ†æå·¥å…·**ï¼š

| åºå· | å·¥å…·åç§° | ç±»å‹ | å¿…å¤‡æ€§ | ä¸»è¦åŠŸèƒ½ | å®‰è£…çŠ¶æ€ |
|------|----------|------|---------|----------|----------|
| 1 | **Tree-sitter + Lizard** | è¯­æ³•åˆ†æ | âœ… å¿…å¤‡ | è¯­æ³•è§£æã€å¤æ‚åº¦åˆ†æ | âœ… å·²å®‰è£… |
| 2 | **Universal CTags** | ç¬¦å·æå– | âœ… å¿…å¤‡ | å¿«é€Ÿç¬¦å·æ ‡ç­¾ç”Ÿæˆ | âœ… v5.9.0 |
| 3 | **Cscope** | è°ƒç”¨åˆ†æ | âœ… å¿…å¤‡ | è°ƒç”¨å…³ç³»ã€å¼•ç”¨åˆ†æ | âœ… v15.9 |
| 4 | **Clangd LSP** | è¯­è¨€æœåŠ¡ | âœ… å¿…å¤‡ | é«˜çº§è¯­ä¹‰åˆ†æ | âœ… v20.1.8 |
| 5 | **TSQuery** | é«˜çº§æŸ¥è¯¢ | âœ… å¿…å¤‡ | Tree-sitteré«˜çº§æŸ¥è¯¢ | âœ… å·²å®‰è£… |

---

## ğŸ¯ å„å·¥å…·ç”Ÿæˆçš„å†…å®¹

### 1ï¸âƒ£ **Tree-sitter + Lizard**
**ç”Ÿæˆå†…å®¹**ï¼š
```json
{
  "name": "function_name",
  "type": "function",
  "file_path": "/path/to/file.c",
  "line_number": 42,
  "return_type": "int",
  "parameters": ["int a", "char* b"],
  "complexity": 5,
  "source": "tree-sitter"
}
```
**ä½œç”¨**ï¼šåŸºç¡€ç¬¦å·æå–ï¼Œä»£ç å¤æ‚åº¦åˆ†æ

### 2ï¸âƒ£ **Universal CTags**
**ç”Ÿæˆå†…å®¹**ï¼š
```json
{
  "name": "MyStruct",
  "type": "structure", 
  "file_path": "/path/to/header.h",
  "line_number": 15,
  "signature": "struct MyStruct",
  "scope": "global",
  "source": "ctags"
}
```
**ä½œç”¨**ï¼šç²¾ç¡®çš„ç¬¦å·å®šä¹‰ï¼Œè·¨æ–‡ä»¶å¼•ç”¨

### 3ï¸âƒ£ **Cscope**
**ç”Ÿæˆå†…å®¹**ï¼š
```json
{
  "function_name": "malloc",
  "type": "function",
  "file_path": "/usr/include/stdlib.h",
  "line_number": 539,
  "call_relations": [...],
  "references": [...],
  "source": "cscope"
}
```
**ä½œç”¨**ï¼šå‡½æ•°è°ƒç”¨é“¾åˆ†æï¼Œç¬¦å·å¼•ç”¨å…³ç³»

### 4ï¸âƒ£ **Clangd LSP** (å¯é€‰)
**ç”Ÿæˆå†…å®¹**ï¼š
```json
{
  "name": "variable_name",
  "type": "variable",
  "file_path": "/path/to/file.c", 
  "line_number": 20,
  "data_type": "const char*",
  "scope": "local",
  "source": "clangd"
}
```
**ä½œç”¨**ï¼šé«˜çº§è¯­ä¹‰ä¿¡æ¯ï¼Œç±»å‹æ¨æ–­

---

## ğŸ”„ å†…å®¹æ•´åˆæœºåˆ¶

### 1ï¸âƒ£ **ç¬¦å·å»é‡ç­–ç•¥**
```python
# ä½¿ç”¨ç»„åˆé”®å»é‡
symbol_key = f"{name}:{file_path}"
if symbol_key not in seen_symbols:
    all_symbols.append(symbol)
    seen_symbols.add(symbol_key)
```

### 2ï¸âƒ£ **æ•´åˆä¼˜å…ˆçº§**
1. **Tree-sitter** (åŸºç¡€ï¼Œæ€»æ˜¯ä¿ç•™)
2. **CTags** (è¡¥å……ç²¾ç¡®ä¿¡æ¯)  
3. **Cscope** (æ·»åŠ è°ƒç”¨å…³ç³»)
4. **Clangd** (å¢å¼ºè¯­ä¹‰ä¿¡æ¯)

### 3ï¸âƒ£ **æ•°æ®æ ‡å‡†åŒ–**
```python
# ç»Ÿä¸€ç¬¦å·æ ¼å¼
standardized_symbol = {
    'name': symbol.get('name'),
    'type': symbol.get('type'),
    'file_path': symbol.get('file_path'),
    'line_number': symbol.get('line_number'),
    'source': 'tool_name'  # æ ‡è®°æ¥æºå·¥å…·
}
```

---

## ğŸ’¾ æ•´åˆåçš„å­˜å‚¨ç»“æ„

### 1ï¸âƒ£ **å‘é‡æ•°æ®åº“** (ChromaDB)
```
data/chroma/
â”œâ”€â”€ chroma.sqlite3           # å…ƒæ•°æ®åº“
â”œâ”€â”€ [uuid]/
â”‚   â”œâ”€â”€ data_level0.bin      # å‘é‡æ•°æ® (~17MB)
â”‚   â”œâ”€â”€ index_metadata.pickle # ç´¢å¼•å…ƒæ•°æ®
â”‚   â””â”€â”€ ...                  # å…¶ä»–ç´¢å¼•æ–‡ä»¶
```

**å­˜å‚¨å†…å®¹**ï¼š
- **æ–‡æ¡£æ–‡æœ¬**ï¼šç¬¦å·çš„æè¿°æ€§æ–‡æœ¬
- **å‘é‡**ï¼šè¯­ä¹‰æœç´¢ç”¨çš„åµŒå…¥å‘é‡
- **å…ƒæ•°æ®**ï¼šç¬¦å·è¯¦ç»†ä¿¡æ¯ï¼ˆç±»å‹ã€ä½ç½®ç­‰ï¼‰

### 2ï¸âƒ£ **é¡¹ç›®å…ƒæ•°æ®** (JSON)
```
data/metadata/
â””â”€â”€ project_name.json       # é¡¹ç›®åˆ†æç»“æœ (~2MB)
```

**å­˜å‚¨å†…å®¹**ï¼š
```json
{
  "project_path": "/path/to/project",
  "symbols_count": 3115,
  "call_edges_count": 42,
  "build_timestamp": 1699123456,
  "analyzers_used": ["tree-sitter", "ctags", "cscope"],
  "symbol_types": ["function", "structure", "variable", "macro"],
  "file_count": 99
}
```

---

## ğŸ® æ•´åˆåå†…å®¹çš„ä½¿ç”¨æ–¹å¼

### 1ï¸âƒ£ **è¯­ä¹‰æœç´¢** (ä½¿ç”¨å‘é‡æ•°æ®åº“)
```python
# AIå¯¹è¯: "æ‰¾åˆ°å†…å­˜åˆ†é…ç›¸å…³çš„å‡½æ•°"
results = vector_store.search("memory allocation functions", limit=10)
# è¿”å›: malloc, calloc, realloc ç­‰ç›¸å…³å‡½æ•°
```

### 2ï¸âƒ£ **ç²¾ç¡®æŸ¥æ‰¾** (ä½¿ç”¨å…ƒæ•°æ®)
```python
# AIå¯¹è¯: "æŸ¥æ‰¾ malloc å‡½æ•°"
results = search_exact_symbol("malloc")
# è¿”å›: malloc å‡½æ•°çš„è¯¦ç»†å®šä¹‰å’Œä½¿ç”¨ä½ç½®
```

### 3ï¸âƒ£ **è°ƒç”¨å…³ç³»åˆ†æ** (ä½¿ç”¨Cscopeæ•°æ®)
```python
# AIå¯¹è¯: "åˆ†æ parse_json å‡½æ•°çš„è°ƒç”¨é“¾"
callees = get_function_callees("parse_json")
callers = get_function_callers("parse_json")
# è¿”å›: è¯¥å‡½æ•°è°ƒç”¨äº†å“ªäº›å‡½æ•°ï¼Œè¢«å“ªäº›å‡½æ•°è°ƒç”¨
```

### 4ï¸âƒ£ **æŒ‰ç±»å‹æµè§ˆ** (ä½¿ç”¨åˆ†ç±»æ•°æ®)
```python
# AIå¯¹è¯: "è¿™ä¸ªé¡¹ç›®æœ‰å“ªäº›ç»“æ„ä½“ï¼Ÿ"
structures = get_symbols_by_type("structure")
# è¿”å›: æ‰€æœ‰ç»“æ„ä½“çš„åˆ—è¡¨
```

### 5ï¸âƒ£ **é¡¹ç›®ç»Ÿè®¡** (ä½¿ç”¨èšåˆæ•°æ®)
```python
# AIå¯¹è¯: "é¡¹ç›®ç»Ÿè®¡ä¿¡æ¯"
stats = get_project_statistics()
# è¿”å›: æ–‡ä»¶æ•°ã€å‡½æ•°æ•°ã€ç»“æ„ä½“æ•°ç­‰ç»Ÿè®¡ä¿¡æ¯
```

---

## ğŸ” MCPå·¥å…·æ˜ å°„

| MCPå·¥å…· | ä½¿ç”¨çš„æ•´åˆæ•°æ® | æ•°æ®æ¥æº |
|---------|----------------|----------|
| `build_c_index` | å…¨éƒ¨å·¥å…·è¾“å‡º | Tree-sitter + CTags + Cscope |
| `search_code_semantic` | å‘é‡æ•°æ®åº“ | æ‰€æœ‰ç¬¦å·çš„æ–‡æœ¬æè¿° |
| `search_symbol_exact` | å…ƒæ•°æ®ç´¢å¼• | ç¬¦å·åç§°å’Œä½ç½®ä¿¡æ¯ |
| `get_project_statistics` | èšåˆç»Ÿè®¡ | å„å·¥å…·çš„ç»Ÿè®¡ç»“æœ |
| `get_symbols_by_type` | åˆ†ç±»ç´¢å¼• | ç¬¦å·ç±»å‹åˆ†ç±» |
| `analyze_function_complexity` | å¤æ‚åº¦æ•°æ® | Lizardåˆ†æç»“æœ |
| `get_callees/get_callers` | è°ƒç”¨å…³ç³»å›¾ | Cscopeè°ƒç”¨åˆ†æ |

---

## ğŸ¯ æ•´åˆçš„ä»·å€¼

### 1ï¸âƒ£ **äº’è¡¥æ€§**
- **Tree-sitter**ï¼šè¯­æ³•å‡†ç¡®æ€§
- **CTags**ï¼šæ ‡ç­¾å®Œæ•´æ€§  
- **Cscope**ï¼šå…³ç³»åˆ†æ

### 2ï¸âƒ£ **é²æ£’æ€§**
- å•ä¸ªå·¥å…·å¤±è´¥ä¸å½±å“æ•´ä½“
- å¤šé‡éªŒè¯æé«˜å‡†ç¡®æ€§

### 3ï¸âƒ£ **å…¨é¢æ€§**
- è¦†ç›–è¯­æ³•ã€è¯­ä¹‰ã€è°ƒç”¨ç­‰å¤šä¸ªç»´åº¦
- æ”¯æŒä¸åŒç±»å‹çš„æŸ¥è¯¢éœ€æ±‚

**ğŸ‰ é€šè¿‡å¤šå·¥å…·æ•´åˆï¼Œå®ç°äº†å…¨æ–¹ä½çš„Cä»£ç æ™ºèƒ½åˆ†æï¼** 